<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Donut Charts with Center Image</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  </head>
  <body class="min-h-screen bg-white flex items-center justify-center p-10">
    <div class="grid grid-cols-2 gap-6">
      <!-- Visitors by Top Countries -->
      <div
        class="bg-white w-[512px] h-[400px] rounded-[20px] shadow p-6 flex flex-col items-center justify-center"
      >
        <h2 class="text-lg font-bold mb-4">Visitors by Top Countries</h2>
        <canvas id="countryChart" class="w-[200px] h-[200px]"></canvas>
      </div>

      <!-- Vehicle Types -->
      <div
        class="bg-white w-[512px] h-[400px] rounded-[20px] shadow p-6 flex flex-col items-center justify-center"
      >
        <h2 class="text-lg font-bold mb-4">Vehicle Types</h2>
        <canvas id="vehicleChart" class="w-[200px] h-[200px]"></canvas>
      </div>
    </div>

    <script>
      const countryLabels = [
        "China",
        "Russia",
        "South Korea",
        "Others",
        "Kazakhstan",
        "Japan",
        "USA",
      ];
      const countryData = [31, 24, 22, 14, 4, 3, 2];

      const countryCtx = document
        .getElementById("countryChart")
        .getContext("2d");
      new Chart(countryCtx, {
        type: "doughnut",
        data: {
          labels: countryLabels,
          datasets: [
            {
              data: countryData,
              backgroundColor: [
                "#F97316",
                "#EF4444",
                "#FBBF24",
                "#22D3EE",
                "#0EA5E9",
                "#A855F7",
                "#EC4899",
              ],
              borderWidth: 0,
            },
          ],
        },
        options: {
          cutout: "80%",
          plugins: {
            legend: { display: false },
            datalabels: {
              color: "#000",
              font: {
                size: 12,
                weight: "bold",
              },
              formatter: (value) => value + "%",
              anchor: "center",
              align: "center",
            },
            tooltip: {
              callbacks: {
                label: (context) =>
                  `${countryLabels[context.dataIndex]}: ${context.parsed}%`,
              },
            },
          },
        },
        plugins: [
          ChartDataLabels,
          {
            id: "countryLabelsOutside",
            afterDatasetsDraw(chart) {
              const ctx = chart.ctx;
              const meta = chart.getDatasetMeta(0);
              const dataset = chart.data.datasets[0];
              meta.data.forEach((element, index) => {
                const angle = (element.startAngle + element.endAngle) / 2;
                const radius = element.outerRadius + 20;
                const x = chart.width / 2 + Math.cos(angle) * radius;
                const y = chart.height / 2 + Math.sin(angle) * radius;
                ctx.save();
                ctx.fillStyle = "#000";
                ctx.font = "12px sans-serif";
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.fillText(countryLabels[index], x, y);
                ctx.restore();
              });
            },
          },
        ],
      });

      const vehicleLabels = [
        "Minibus",
        "4WD SUV",
        "Bus",
        "Mid-Size Crossover",
        "Compact car",
        "Motorcycle",
      ];
      const vehicleData = [30, 25, 20, 15, 5, 5];
      const vehicleIcons = {
        Minibus: "üöê",
        "4WD SUV": "üöô",
        Bus: "üöå",
        "Mid-Size Crossover": "üõª",
        "Compact car": "üöó",
        Motorcycle: "üèçÔ∏è",
      };

      const vehicleCtx = document
        .getElementById("vehicleChart")
        .getContext("2d");
      new Chart(vehicleCtx, {
        type: "doughnut",
        data: {
          labels: vehicleLabels,
          datasets: [
            {
              data: vehicleData,
              backgroundColor: [
                "#F97316",
                "#EF4444",
                "#FBBF24",
                "#A855F7",
                "#38BDF8",
                "#06B6D4",
              ],
              borderWidth: 0,
            },
          ],
        },
        options: {
          cutout: "80%",
          plugins: {
            legend: { display: false },
            datalabels: {
              color: "#000",
              font: {
                size: 12,
                weight: "bold",
              },
              formatter: (value) => value + "%",
              anchor: "center",
              align: "center",
            },
            tooltip: {
              callbacks: {
                label: (context) =>
                  `${vehicleIcons[vehicleLabels[context.dataIndex]]} ${
                    vehicleLabels[context.dataIndex]
                  }: ${context.parsed}%`,
              },
            },
          },
        },
        plugins: [
          ChartDataLabels,
          {
            id: "vehicleLabelsOutside",
            afterDatasetsDraw(chart) {
              const ctx = chart.ctx;
              const meta = chart.getDatasetMeta(0);
              meta.data.forEach((element, index) => {
                const angle = (element.startAngle + element.endAngle) / 2;
                const radius = element.outerRadius + 20;
                const x = chart.width / 2 + Math.cos(angle) * radius;
                const y = chart.height / 2 + Math.sin(angle) * radius;
                ctx.save();
                ctx.fillStyle = "#000";
                ctx.font = "12px sans-serif";
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.fillText(
                  `${vehicleIcons[vehicleLabels[index]]} ${
                    vehicleLabels[index]
                  }`,
                  x,
                  y
                );
                ctx.restore();
              });
            },
          },
          {
            id: "centerImage",
            afterDraw(chart) {
              const image = new Image();
              image.src = "images/bus.png"; // <-- ”®”©—Ä–∏–π–Ω –∑—É—Ä–≥–∞–Ω –∑–∞–º–∞–∞ –æ—Ä—É—É–ª
              image.onload = () => {
                const ctx = chart.ctx;
                const size = 50; // –ó—É—Ä–∞–≥–Ω—ã —Ö—ç–º–∂—ç—ç
                const x = chart.width / 2 - size / 2;
                const y = chart.height / 2 - size / 2;
                ctx.save();
                ctx.drawImage(image, x, y, size, size);
                ctx.restore();
              };
            },
          },
        ],
      });
    </script>
  </body>
</html>
